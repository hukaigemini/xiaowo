# 会话管理模块完整修复计划

## 1. 修复 room.go 中的 v1types 错误

**问题**：在 `UpdateRoom` 函数中使用了 `v1types.UpdateRoomRequest`，但 v1types 包不存在

**解决方案**：
- 修改 `/Users/hukai/Documents/trae_projects/xiaowo/backend/internal/api/v1/room.go` 中的 `UpdateRoom` 函数
- 将 `var req v1types.UpdateRoomRequest` 改为 `var req UpdateRoomRequest`
- 确保所有相关引用都使用本地类型定义

## 2. 修复 types.go 中的结构体定义问题

**问题**：`RoomResponse` 结构体存在重复字段定义

**解决方案**：
- 修改 `/Users/hukai/Documents/trae_projects/xiaowo/backend/internal/api/v1/types.go`
- 移除第 88-100 行的重复字段定义
- 确保 `RoomResponse` 结构体只包含正确的字段

## 3. 修复 room_service.go 中的类型指针和 JSON 字面量问题

**问题**：
- ValidateMediaURL 方法调用的类型指针问题
- JSON 复合字面量语法错误

**解决方案**：
- 修改 `/Users/hukai/Documents/trae_projects/xiaowo/backend/internal/service/room_service.go`
- 确保 `roomRepo` 是接口类型而不是指针类型
- 修复 JSON 字面量的语法错误
- 确保所有方法调用的参数类型正确

## 4. 修复 WebSocket 相关问题

**问题**：websocket/hub.go 中可能存在类型定义和引用问题

**解决方案**：
- 验证 `/Users/hukai/Documents/trae_projects/xiaowo/backend/internal/websocket/hub.go` 中的类型定义
- 确保所有消息类型和结构体定义正确
- 修复任何引用错误

## 5. 确保接口实现完整性

**问题**：某些结构体可能没有完全实现接口

**解决方案**：
- 检查所有仓库结构体是否实现了对应的接口方法
- 确保 `SessionRepository`、`RoomRepository` 等接口的所有方法都被正确实现

## 6. 验证会话管理模块的功能完整性

**任务**：
- 运行 `go build` 命令验证编译通过
- 检查是否有任何编译警告或错误
- 验证所有会话管理相关的 API 路由是否正确配置
- 确保会话创建、更新、删除、验证等功能正常

## 7. 修复其他遗留问题

**任务**：
- 修复任何其他编译错误或警告
- 确保代码符合 Go 语言规范
- 验证所有依赖关系正确

## 执行顺序

1. 修复 room.go 中的 v1types 错误
2. 修复 types.go 中的结构体定义问题
3. 修复 room_service.go 中的类型指针和 JSON 字面量问题
4. 修复 WebSocket 相关问题
5. 确保接口实现完整性
6. 验证会话管理模块的功能完整性
7. 修复其他遗留问题

## 预期结果

- 编译通过，无任何错误或警告
- 会话管理模块的所有功能正常工作
- API 可以正确处理会话创建、更新、删除、验证等请求
- WebSocket 连接可以正常建立和管理
- 房间创建、加入、离开等功能正常

## 验证方法

- 运行 `go build ./...` 命令验证编译通过
- 检查所有相关文件的语法和类型错误
- 验证 API 路由是否正确配置
- 确保所有服务和仓库的依赖关系正确