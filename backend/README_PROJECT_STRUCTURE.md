# å°çªé¡¹ç›® - Goåç«¯ç›®å½•ç»“æ„

## ğŸ“ é¡¹ç›®ç»“æ„æ ‘

```
xiaowo-backend/
â”œâ”€â”€ cmd/                          # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ server/                   # ä¸»æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ main.go              # åº”ç”¨ç¨‹åºå¯åŠ¨ç‚¹
â”‚   â””â”€â”€ migration/                # æ•°æ®åº“è¿ç§»å·¥å…·
â”‚       â””â”€â”€ main.go              # æ•°æ®åº“è¿ç§»å…¥å£
â”‚
â”œâ”€â”€ internal/                     # ç§æœ‰åº”ç”¨ä»£ç ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ api/                     # APIå±‚ï¼ˆè·¯ç”±ã€æ§åˆ¶å™¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ handlers/            # HTTPè¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ routes/              # è·¯ç”±å®šä¹‰
â”‚   â”‚   â””â”€â”€ server.go            # HTTPæœåŠ¡å™¨é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ service/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ user_service.go      # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ room_service.go      # æˆ¿é—´æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ message_service.go   # æ¶ˆæ¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ sync_service.go      # åŒæ­¥æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/              # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go          # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ room.go          # æˆ¿é—´æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ message.go       # æ¶ˆæ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ db/                  # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repo.go     # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”œâ”€â”€ room_repo.go     # æˆ¿é—´æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â””â”€â”€ message_repo.go  # æ¶ˆæ¯æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ migrations/          # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ websocket/               # WebSocketç›¸å…³
â”‚   â”‚   â”œâ”€â”€ hub.go               # WebSocket Hub
â”‚   â”‚   â”œâ”€â”€ connection.go        # è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ handler.go           # WebSocketæ¶ˆæ¯å¤„ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                  # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config.go            # é…ç½®ç»“æ„ä½“
â”‚   â”‚   â””â”€â”€ database.go          # æ•°æ®åº“é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ error.go             # é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ logger.go            # æ—¥å¿—å·¥å…·
â”‚       â””â”€â”€ validation.go        # å‚æ•°éªŒè¯
â”‚
â”œâ”€â”€ pkg/                         # å…¬å…±åº“ï¼ˆå¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ types/                   # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.go               # APIè¯·æ±‚/å“åº”ç±»å‹
â”‚   â”‚   â”œâ”€â”€ websocket.go         # WebSocketæ¶ˆæ¯ç±»å‹
â”‚   â”‚   â””â”€â”€ common.go            # é€šç”¨ç±»å‹
â”‚   â”œâ”€â”€ errors/                  # é”™è¯¯å®šä¹‰
â”‚   â”‚   â””â”€â”€ errors.go            # é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯
â”‚   â””â”€â”€ utils/                   # å…¬å…±å·¥å…·
â”‚       â”œâ”€â”€ time.go              # æ—¶é—´å¤„ç†å·¥å…·
â”‚       â””â”€â”€ string.go            # å­—ç¬¦ä¸²å·¥å…·
â”‚
â”œâ”€â”€ scripts/                     # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ build.sh                 # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ test.sh                  # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ docker-build.sh          # Dockeræ„å»ºè„šæœ¬
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                     # APIæ–‡æ¡£
â”‚   â””â”€â”€ database/                # æ•°æ®åº“æ–‡æ¡£
â”‚
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ docker-compose.yml           # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile                   # Dockeré•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ go.mod                       # Goæ¨¡å—æ–‡ä»¶
â”œâ”€â”€ go.sum                       # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ Makefile                     # Makeå‘½ä»¤æ–‡ä»¶
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ“‹ ç›®å½•è¯´æ˜

### cmd/ - åº”ç”¨ç¨‹åºå…¥å£
- **server/main.go**: HTTPæœåŠ¡å™¨ä¸»å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨APIæœåŠ¡
- **migration/main.go**: æ•°æ®åº“è¿ç§»å·¥å…·å…¥å£ï¼Œè´Ÿè´£æ‰§è¡ŒDDLè„šæœ¬

### internal/ - ç§æœ‰åº”ç”¨ä»£ç 
- **api/**: HTTPå±‚ï¼Œè´Ÿè´£è·¯ç”±ã€è¯·æ±‚å¤„ç†ã€å“åº”æ ¼å¼åŒ–
  - `handlers/`: å…·ä½“ä¸šåŠ¡è¯·æ±‚å¤„ç†å™¨ï¼ˆControllerå±‚ï¼‰
  - `routes/`: APIè·¯ç”±å®šä¹‰
  - `server.go`: HTTPæœåŠ¡å™¨é…ç½®å’Œå¯åŠ¨

- **service/**: ä¸šåŠ¡é€»è¾‘å±‚ï¼Œè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡å¤„ç†
  - `user_service.go`: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¼šè¯ç®¡ç†
  - `room_service.go`: æˆ¿é—´åˆ›å»ºã€åŠ å…¥ã€ç¦»å¼€
  - `message_service.go`: æ¶ˆæ¯å­˜å‚¨å’Œå¹¿æ’­
  - `sync_service.go`: æ’­æ”¾çŠ¶æ€åŒæ­¥é€»è¾‘

- **repository/**: æ•°æ®è®¿é—®å±‚ï¼Œè´Ÿè´£æ•°æ®åº“æ“ä½œ
  - `models/`: æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆæ•°æ®åº“è¡¨ç»“æ„æ˜ å°„ï¼‰
  - `db/`: å…·ä½“çš„æ•°æ®è®¿é—®å®ç°ï¼ˆRepositoryæ¨¡å¼ï¼‰
  - `migrations/`: æ•°æ®åº“è¿ç§»æ–‡ä»¶

- **websocket/**: WebSocketå®æ—¶é€šä¿¡
  - `hub.go`: WebSocketè¿æ¥ç®¡ç†å™¨
  - `connection.go`: å•ä¸ªè¿æ¥ç®¡ç†
  - `handler.go`: WebSocketæ¶ˆæ¯è·¯ç”±å’Œå¤„ç†

- **config/**: é…ç½®ç®¡ç†
  - `config.go`: åº”ç”¨é…ç½®ç»“æ„ä½“
  - `database.go`: æ•°æ®åº“è¿æ¥é…ç½®

### pkg/ - å…¬å…±åº“
- **types/**: å…±äº«ç±»å‹å®šä¹‰ï¼Œä¾›å†…éƒ¨å’Œå¤–éƒ¨ä½¿ç”¨
- **errors/**: ç»Ÿä¸€é”™è¯¯ç å®šä¹‰
- **utils/**: å…¬å…±å·¥å…·å‡½æ•°

### scripts/ - æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
- `build.sh`: æœ¬åœ°å¼€å‘æ„å»ºè„šæœ¬
- `test.sh`: å•å…ƒæµ‹è¯•æ‰§è¡Œè„šæœ¬
- `docker-build.sh`: Dockeré•œåƒæ„å»ºè„šæœ¬

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. åˆ†å±‚æ¶æ„æ¸…æ™°
```
HTTP Request â†’ Handler â†’ Service â†’ Repository â†’ Database
     â†‘                                          â†“
     â†â”€â”€ WebSocket Hub â†â”€â”€â”€ Real-time Events â†â”€â”€â”˜
```

### 2. ä¾èµ–æ–¹å‘è§„èŒƒ
- `cmd` ä¾èµ– `internal` å’Œ `pkg`
- `internal` ä¾èµ– `pkg`
- `internal` æ¨¡å—é—´é€šè¿‡æ¥å£è§£è€¦

### 3. ä»£ç ç»„ç»‡åŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶å’Œå‡½æ•°åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½
- **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
- **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒå‡†å¤‡
```bash
# 1. å®‰è£…ä¾èµ–
go mod tidy

# 2. å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env

# 3. è¿è¡Œæ•°æ®åº“è¿ç§»
go run cmd/migration/main.go

# 4. å¯åŠ¨æœåŠ¡
go run cmd/server/main.go
```

### å¸¸ç”¨å‘½ä»¤
```bash
# æ„å»º
make build

# æµ‹è¯•
make test

# è¿è¡Œ
make run

# Dockeræ„å»º
make docker-build
```

è¿™ä¸ªç›®å½•ç»“æ„éµå¾ªGoç¤¾åŒºæœ€ä½³å®è·µï¼Œç¡®ä¿ä»£ç å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚